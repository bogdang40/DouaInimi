<!-- Mobile Bottom Navigation - Only visible on mobile -->
{% if current_user.is_authenticated %}
<nav class="fixed bottom-0 left-0 right-0 md:hidden z-40" id="mobile-bottom-nav">
    <div class="bg-white/95 dark:bg-surface-900/95 backdrop-blur-xl border-t border-surface-200 dark:border-white/10 shadow-lg shadow-black/5 dark:shadow-black/20">
        <!-- Safe area padding for notched devices -->
        <div class="flex items-center justify-around px-1" style="padding-bottom: max(env(safe-area-inset-bottom, 8px), 8px);">
            <!-- Discover -->
            <a href="{{ url_for('discover.swipe') }}"
               onclick="navHaptic()"
               class="nav-item flex flex-col items-center justify-center py-2.5 px-3 min-w-[64px] rounded-xl transition-all active:scale-95
                      {% if request.endpoint and request.endpoint.startswith('discover') %}
                      text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-500/10
                      {% else %}
                      text-surface-500 dark:text-surface-400
                      {% endif %}">
                <i data-lucide="flame" class="w-6 h-6"></i>
                <span class="text-[10px] mt-0.5 font-medium">Discover</span>
            </a>

            <!-- Matches -->
            <a href="{{ url_for('matches.list') }}"
               onclick="navHaptic()"
               class="nav-item flex flex-col items-center justify-center py-2.5 px-3 min-w-[64px] rounded-xl transition-all active:scale-95 relative
                      {% if request.endpoint and request.endpoint.startswith('matches') %}
                      text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-500/10
                      {% else %}
                      text-surface-500 dark:text-surface-400
                      {% endif %}">
                <div class="relative">
                    <i data-lucide="heart" class="w-6 h-6"></i>
                    {% if user_matches_count and user_matches_count > 0 %}
                    <span class="absolute -top-1.5 -right-1.5 min-w-[18px] h-[18px] bg-amber-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1">
                        {{ user_matches_count if user_matches_count < 99 else '99' }}
                    </span>
                    {% endif %}
                </div>
                <span class="text-[10px] mt-0.5 font-medium">Matches</span>
            </a>

            <!-- Messages -->
            <a href="{{ url_for('messages.inbox') }}"
               onclick="navHaptic()"
               class="nav-item flex flex-col items-center justify-center py-2.5 px-3 min-w-[64px] rounded-xl transition-all active:scale-95 relative
                      {% if request.endpoint and request.endpoint.startswith('messages') %}
                      text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-500/10
                      {% else %}
                      text-surface-500 dark:text-surface-400
                      {% endif %}">
                <div class="relative">
                    <i data-lucide="message-circle" class="w-6 h-6"></i>
                    {% if total_unread_messages and total_unread_messages > 0 %}
                    <span class="absolute -top-1.5 -right-1.5 min-w-[18px] h-[18px] bg-rose-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 unread-badge animate-pulse">
                        {{ total_unread_messages if total_unread_messages < 99 else '99' }}
                    </span>
                    {% endif %}
                </div>
                <span class="text-[10px] mt-0.5 font-medium">Messages</span>
            </a>

            <!-- Profile -->
            <a href="{{ url_for('profile.view', user_id=current_user.id) }}"
               onclick="navHaptic()"
               class="nav-item flex flex-col items-center justify-center py-2.5 px-3 min-w-[64px] rounded-xl transition-all active:scale-95
                      {% if request.endpoint and (request.endpoint.startswith('profile') or request.endpoint.startswith('settings')) %}
                      text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-500/10
                      {% else %}
                      text-surface-500 dark:text-surface-400
                      {% endif %}">
                {% if current_user.primary_photo %}
                <img src="{{ current_user.primary_photo_url }}"
                     alt="Profile"
                     class="w-7 h-7 rounded-full object-cover ring-2
                            {% if request.endpoint and (request.endpoint.startswith('profile') or request.endpoint.startswith('settings')) %}
                            ring-amber-500
                            {% else %}
                            ring-surface-300 dark:ring-surface-600
                            {% endif %}">
                {% else %}
                <i data-lucide="user" class="w-6 h-6"></i>
                {% endif %}
                <span class="text-[10px] mt-0.5 font-medium">Profile</span>
            </a>
        </div>
    </div>
</nav>

<script>
// Haptic feedback for navigation
function navHaptic() {
    if ('vibrate' in navigator) {
        navigator.vibrate(10);
    }
}

// Hide bottom nav on scroll down, show on scroll up (for more content space)
(function() {
    const nav = document.getElementById('mobile-bottom-nav');
    if (!nav) return;

    let lastScrollY = window.scrollY;
    let ticking = false;

    function updateNav() {
        const currentScrollY = window.scrollY;

        // Only hide/show if scrolled more than 50px
        if (Math.abs(currentScrollY - lastScrollY) < 50) {
            ticking = false;
            return;
        }

        if (currentScrollY > lastScrollY && currentScrollY > 100) {
            // Scrolling down - hide nav
            nav.style.transform = 'translateY(100%)';
        } else {
            // Scrolling up - show nav
            nav.style.transform = 'translateY(0)';
        }

        lastScrollY = currentScrollY;
        ticking = false;
    }

    window.addEventListener('scroll', function() {
        if (!ticking) {
            window.requestAnimationFrame(updateNav);
            ticking = true;
        }
    }, { passive: true });

    // Add smooth transition
    nav.style.transition = 'transform 0.3s ease-out';
})();
</script>

<!-- Spacer to prevent content from being hidden behind bottom nav on mobile -->
<div class="h-[72px] md:hidden"></div>
{% endif %}
