{% extends 'base.html' %}

{% block title %}Matches - {{ app_name }}{% endblock %}

{% block main_class %}pb-20 md:pb-0{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-surface-50 dark:bg-transparent min-h-screen">
    <div class="mb-8">
        <h1 class="font-display text-3xl font-bold text-surface-900 dark:text-white">Your Matches</h1>
        <p class="mt-1 text-surface-600 dark:text-gray-400">People who like you back ðŸ’•</p>
    </div>
    
    {% if matches %}
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        {% for match in matches %}
        {% set other_user = match.get_other_user(current_user.id) %}
        <a href="{{ url_for('messages.conversation', match_id=match.id) }}" 
           class="bg-white dark:bg-white/5 border border-surface-200 dark:border-white/10 rounded-2xl overflow-hidden hover:shadow-lg dark:hover:bg-white/10 transition group">
            <div class="aspect-square relative overflow-hidden">
                <img src="{{ other_user.primary_photo_url }}" 
                     alt="{{ other_user.display_name }}"
                     class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"></div>
                
                <!-- Unread badge -->
                {% set unread = match.unread_count(current_user.id) %}
                {% if unread > 0 %}
                <div class="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold">
                    {{ unread if unread < 10 else '9+' }}
                </div>
                {% endif %}
                
                <!-- Name overlay -->
                <div class="absolute bottom-0 left-0 right-0 p-3">
                    <h3 class="font-semibold text-white truncate">{{ other_user.display_name }}</h3>
                    {% if other_user.profile %}
                    <p class="text-xs text-white/80">{{ other_user.profile.city }}</p>
                    {% endif %}
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
    
    {% else %}
    <!-- Empty State -->
    <div class="text-center py-16 bg-white dark:bg-white/5 border border-surface-200 dark:border-white/10 rounded-2xl">
        <div class="w-20 h-20 bg-red-100 dark:bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
            <i data-lucide="heart" class="w-10 h-10 text-red-600 dark:text-red-400"></i>
        </div>
        <h3 class="font-display text-2xl font-semibold text-surface-900 dark:text-white mb-2">No Matches Yet</h3>
        <p class="text-surface-600 dark:text-gray-400 max-w-md mx-auto mb-6">
            When you and another person both like each other, you'll see them here. Keep exploring!
        </p>
        <a href="{{ url_for('discover.browse') }}" 
           class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-full hover:from-amber-400 hover:to-amber-500 transition">
            <i data-lucide="compass" class="w-4 h-4 mr-2"></i>
            Discover People
        </a>
    </div>
    {% endif %}
    
    <!-- Pending Likes Section -->
    {% if pending_likes %}
    <div class="mt-12">
        <div class="flex items-center justify-between mb-6">
            <h2 class="font-display text-xl font-semibold text-surface-900 dark:text-white">
                People Who Liked You <span class="text-red-600 dark:text-red-400">({{ pending_likes|length }})</span>
            </h2>
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
            {% for like in pending_likes[:8] %}
            {% set liker = like.liker %}
            <div class="bg-white dark:bg-white/5 border border-surface-200 dark:border-white/10 rounded-2xl overflow-hidden">
                <div class="aspect-square relative overflow-hidden">
                    <img src="{{ liker.primary_photo_url }}" 
                         alt="{{ liker.display_name }}"
                         class="w-full h-full object-cover blur-md">
                    <div class="absolute inset-0 bg-surface-900/40 dark:bg-surface-950/60 flex items-center justify-center">
                        <i data-lucide="heart" class="w-10 h-10 text-red-500"></i>
                    </div>
                </div>
                <div class="p-3 flex space-x-2">
                    <form action="{{ url_for('discover.pass_user', user_id=liker.id) }}" method="POST" class="flex-1">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="w-full py-2 bg-surface-100 dark:bg-white/5 border border-surface-200 dark:border-white/10 rounded-lg text-surface-500 dark:text-gray-400 hover:bg-surface-200 dark:hover:bg-white/10 text-sm">
                            <i data-lucide="x" class="w-4 h-4 mx-auto"></i>
                        </button>
                    </form>
                    <form action="{{ url_for('discover.like_user', user_id=liker.id) }}" method="POST" class="flex-1">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="w-full py-2 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg text-sm">
                            <i data-lucide="heart" class="w-4 h-4 mx-auto"></i>
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
