{% extends "admin/base_admin.html" %}

{% block title %}Reports{% endblock %}
{% block header %}User Reports{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Filters -->
    <div class="bg-surface-900 rounded-xl p-6 border border-white/5">
        <div class="flex items-center gap-4">
            <a href="{{ url_for('admin.reports', status='pending') }}" 
               class="px-4 py-2 rounded-lg font-medium transition-colors {{ 'bg-amber-500 text-black' if status == 'pending' else 'bg-surface-800 text-gray-300 hover:bg-surface-700' }}">
                Pending
            </a>
            <a href="{{ url_for('admin.reports', status='resolved') }}" 
               class="px-4 py-2 rounded-lg font-medium transition-colors {{ 'bg-amber-500 text-black' if status == 'resolved' else 'bg-surface-800 text-gray-300 hover:bg-surface-700' }}">
                Resolved
            </a>
            <a href="{{ url_for('admin.reports', status='dismissed') }}" 
               class="px-4 py-2 rounded-lg font-medium transition-colors {{ 'bg-amber-500 text-black' if status == 'dismissed' else 'bg-surface-800 text-gray-300 hover:bg-surface-700' }}">
                Dismissed
            </a>
            <a href="{{ url_for('admin.reports', status='all') }}" 
               class="px-4 py-2 rounded-lg font-medium transition-colors {{ 'bg-amber-500 text-black' if status == 'all' else 'bg-surface-800 text-gray-300 hover:bg-surface-700' }}">
                All
            </a>
        </div>
    </div>

    <!-- Reports Table -->
    <div class="bg-surface-900 rounded-xl border border-white/5 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead class="bg-surface-950 border-b border-white/5">
                    <tr>
                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Reporter</th>
                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Reported User</th>
                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Reason</th>
                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-4 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    {% for report in reports.items %}
                    <tr class="hover:bg-white/5 transition-colors">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <img src="{{ report.reporter.primary_photo_url if report.reporter else '/static/images/default-avatar.svg' }}" 
                                     alt="" class="h-8 w-8 rounded-full object-cover mr-3 border border-white/10">
                                <div class="text-white">{{ report.reporter.email if report.reporter else 'Deleted' }}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <img src="{{ report.reported.primary_photo_url if report.reported else '/static/images/default-avatar.svg' }}" 
                                     alt="" class="h-8 w-8 rounded-full object-cover mr-3 border border-white/10">
                                <div class="text-white">{{ report.reported.email if report.reported else 'Deleted' }}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-gray-300">{{ report.reason }}</div>
                            {% if report.description %}
                            <div class="text-gray-500 text-xs mt-1 truncate max-w-xs">{{ report.description }}</div>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 text-gray-400">
                            {{ report.created_at.strftime('%b %d, %Y') if report.created_at else 'Unknown' }}
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-0.5 rounded text-xs font-medium 
                                {{ 'bg-yellow-900/30 text-yellow-400 border border-yellow-500/30' if report.status == 'pending' else 
                                   'bg-green-900/30 text-green-400 border border-green-500/30' if report.status == 'resolved' else 
                                   'bg-gray-900/30 text-gray-400 border border-gray-500/30' }}">
                                {{ report.status|capitalize }}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <a href="{{ url_for('admin.report_detail', report_id=report.id) }}" 
                               class="text-blue-400 hover:text-blue-300 font-medium text-sm">
                                View Details â†’
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                            No reports found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    {% if reports.pages > 1 %}
    <div class="flex items-center justify-center gap-2">
        {% if reports.has_prev %}
        <a href="{{ url_for('admin.reports', page=reports.prev_num, status=status) }}" 
           class="px-4 py-2 bg-surface-900 text-gray-300 rounded-lg hover:bg-surface-800 transition-colors">
            <i data-lucide="chevron-left" class="w-4 h-4"></i>
        </a>
        {% endif %}
        
        {% for page_num in reports.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if page_num == reports.page %}
                <span class="px-4 py-2 bg-amber-500 text-black rounded-lg font-bold">{{ page_num }}</span>
                {% else %}
                <a href="{{ url_for('admin.reports', page=page_num, status=status) }}" 
                   class="px-4 py-2 bg-surface-900 text-gray-300 rounded-lg hover:bg-surface-800 transition-colors">{{ page_num }}</a>
                {% endif %}
            {% else %}
            <span class="px-2 text-gray-500">...</span>
            {% endif %}
        {% endfor %}
        
        {% if reports.has_next %}
        <a href="{{ url_for('admin.reports', page=reports.next_num, status=status) }}" 
           class="px-4 py-2 bg-surface-900 text-gray-300 rounded-lg hover:bg-surface-800 transition-colors">
            <i data-lucide="chevron-right" class="w-4 h-4"></i>
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
