{% extends 'base.html' %}

{% block title %}Reports - Admin - {{ app_name }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-surface-50 dark:bg-surface-950 py-8">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <a href="{{ url_for('admin.dashboard') }}" class="text-sm text-surface-500 dark:text-gray-400 hover:text-surface-700 dark:hover:text-white mb-2 inline-flex items-center">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i>
                    Back to Dashboard
                </a>
                <h1 class="font-display text-3xl font-bold text-surface-900 dark:text-white">User Reports</h1>
            </div>
        </div>
        
        <!-- Status Tabs -->
        <div class="flex space-x-2 mb-6">
            <a href="{{ url_for('admin.reports', status='pending') }}" 
               class="px-4 py-2 rounded-lg text-sm font-medium transition
                      {% if status == 'pending' %}
                      bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-400
                      {% else %}
                      bg-white dark:bg-white/5 border border-surface-200 dark:border-white/10 text-surface-600 dark:text-gray-400 hover:bg-surface-50 dark:hover:bg-white/10
                      {% endif %}">
                Pending
            </a>
            <a href="{{ url_for('admin.reports', status='resolved') }}" 
               class="px-4 py-2 rounded-lg text-sm font-medium transition
                      {% if status == 'resolved' %}
                      bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400
                      {% else %}
                      bg-white dark:bg-white/5 border border-surface-200 dark:border-white/10 text-surface-600 dark:text-gray-400 hover:bg-surface-50 dark:hover:bg-white/10
                      {% endif %}">
                Resolved
            </a>
            <a href="{{ url_for('admin.reports', status='dismissed') }}" 
               class="px-4 py-2 rounded-lg text-sm font-medium transition
                      {% if status == 'dismissed' %}
                      bg-surface-200 dark:bg-white/10 text-surface-700 dark:text-gray-300
                      {% else %}
                      bg-white dark:bg-white/5 border border-surface-200 dark:border-white/10 text-surface-600 dark:text-gray-400 hover:bg-surface-50 dark:hover:bg-white/10
                      {% endif %}">
                Dismissed
            </a>
            <a href="{{ url_for('admin.reports', status='all') }}" 
               class="px-4 py-2 rounded-lg text-sm font-medium transition
                      {% if status == 'all' %}
                      bg-purple-100 dark:bg-purple-500/20 text-purple-700 dark:text-purple-400
                      {% else %}
                      bg-white dark:bg-white/5 border border-surface-200 dark:border-white/10 text-surface-600 dark:text-gray-400 hover:bg-surface-50 dark:hover:bg-white/10
                      {% endif %}">
                All
            </a>
        </div>
        
        <!-- Reports List -->
        <div class="bg-white dark:bg-white/5 border border-surface-200 dark:border-white/10 rounded-xl overflow-hidden">
            {% if reports.items %}
            <div class="divide-y divide-surface-200 dark:divide-white/10">
                {% for report in reports.items %}
                <a href="{{ url_for('admin.report_detail', report_id=report.id) }}" 
                   class="block p-5 hover:bg-surface-50 dark:hover:bg-white/5 transition">
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex items-start gap-4 flex-1 min-w-0">
                            <!-- Reported User -->
                            <img src="{{ report.reported.primary_photo_url }}" 
                                 alt="{{ report.reported.display_name }}"
                                 class="w-12 h-12 rounded-full object-cover flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1">
                                    <h3 class="font-medium text-surface-900 dark:text-white">{{ report.reported.display_name }}</h3>
                                    <span class="text-surface-400 dark:text-gray-500">•</span>
                                    <span class="text-sm text-surface-500 dark:text-gray-400 capitalize">{{ report.reason.replace('_', ' ') }}</span>
                                </div>
                                <p class="text-sm text-surface-600 dark:text-gray-400 line-clamp-2">
                                    {{ report.description or 'No description provided' }}
                                </p>
                                <p class="text-xs text-surface-400 dark:text-gray-500 mt-2">
                                    Reported by {{ report.reporter.display_name }} · {{ report.created_at.strftime('%b %d, %Y at %I:%M %p') }}
                                </p>
                            </div>
                        </div>
                        
                        <span class="inline-flex px-3 py-1 text-xs font-medium rounded-full flex-shrink-0
                                     {% if report.status == 'pending' %}bg-yellow-100 dark:bg-yellow-500/20 text-yellow-700 dark:text-yellow-400
                                     {% elif report.status == 'resolved' %}bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400
                                     {% else %}bg-surface-100 dark:bg-white/10 text-surface-600 dark:text-gray-400{% endif %}">
                            {{ report.status }}
                        </span>
                    </div>
                </a>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if reports.pages > 1 %}
            <div class="px-5 py-4 border-t border-surface-200 dark:border-white/10 flex items-center justify-between">
                <p class="text-sm text-surface-500 dark:text-gray-400">
                    Showing {{ reports.per_page * (reports.page - 1) + 1 }} to {{ [reports.per_page * reports.page, reports.total] | min }} of {{ reports.total }} reports
                </p>
                <nav class="flex items-center space-x-2">
                    {% if reports.has_prev %}
                    <a href="{{ url_for('admin.reports', page=reports.prev_num, status=status) }}" 
                       class="px-3 py-1.5 bg-surface-100 dark:bg-white/5 border border-surface-200 dark:border-white/10 rounded-lg text-surface-700 dark:text-gray-300 hover:bg-surface-200 dark:hover:bg-white/10 transition text-sm">
                        Previous
                    </a>
                    {% endif %}
                    <span class="text-sm text-surface-500 dark:text-gray-400">
                        Page {{ reports.page }} of {{ reports.pages }}
                    </span>
                    {% if reports.has_next %}
                    <a href="{{ url_for('admin.reports', page=reports.next_num, status=status) }}" 
                       class="px-3 py-1.5 bg-surface-100 dark:bg-white/5 border border-surface-200 dark:border-white/10 rounded-lg text-surface-700 dark:text-gray-300 hover:bg-surface-200 dark:hover:bg-white/10 transition text-sm">
                        Next
                    </a>
                    {% endif %}
                </nav>
            </div>
            {% endif %}
            {% else %}
            <div class="p-12 text-center">
                <div class="w-16 h-16 bg-green-100 dark:bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="check-circle" class="w-8 h-8 text-green-600 dark:text-green-400"></i>
                </div>
                <h3 class="font-semibold text-surface-900 dark:text-white mb-1">No Reports</h3>
                <p class="text-surface-500 dark:text-gray-400">
                    {% if status == 'pending' %}
                    All caught up! No pending reports to review.
                    {% else %}
                    No {{ status }} reports found.
                    {% endif %}
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

